openapi: 3.0.3
info:
  title: Furballs Backend API
  description: E-commerce backend API built with FastAPI for the Keychain Crew (Furballs) online store
  version: 1.0.0
  contact:
    name: Keychain Crew Development Team
  license:
    name: Proprietary
servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.soar-commerce.com
    description: Production server

tags:
  - name: health
    description: Health check endpoints
  - name: auth
    description: Authentication and authorization
  - name: users
    description: User management
  - name: products
    description: Product management
  - name: orders
    description: Order management
  - name: shipping
    description: Shipping and logistics
  - name: payments
    description: Payment processing
  - name: categories
    description: Product categories
  - name: cart
    description: Shopping cart
  - name: checkout
    description: Checkout process
  - name: upload
    description: File uploads
  - name: profile
    description: User profiles
  - name: email
    description: Email services

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
          format: email
        first_name:
          type: string
        last_name:
          type: string
        created_at:
          type: string
          format: date-time
      required:
        - email
        - first_name
        - last_name

    UserCreate:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        first_name:
          type: string
        last_name:
          type: string
      required:
        - email
        - password
        - first_name
        - last_name

    Token:
      type: object
      properties:
        access_token:
          type: string
        token_type:
          type: string
        user_id:
          type: string
      required:
        - access_token
        - token_type

    Image:
      type: object
      properties:
        image_url:
          type: string
          format: uri
        alt_text:
          type: string
        image_priority:
          type: integer
          minimum: 0
      required:
        - image_url

    Product:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
          minLength: 3
          maxLength: 100
        description:
          type: string
        price:
          type: number
          minimum: 0
        images:
          type: array
          items:
            $ref: '#/components/schemas/Image'
        item_number:
          type: string
        category:
          type: string
        stock:
          type: integer
          minimum: 0
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
      required:
        - name
        - description
        - price
        - category

    ProductCreate:
      type: object
      properties:
        name:
          type: string
          minLength: 3
          maxLength: 100
        description:
          type: string
        price:
          type: number
          minimum: 0
        images:
          type: array
          items:
            $ref: '#/components/schemas/Image'
        item_number:
          type: string
        category:
          type: string
        stock:
          type: integer
          minimum: 0
      required:
        - name
        - description
        - price
        - category

    OrderItem:
      type: object
      properties:
        product_id:
          type: string
        quantity:
          type: integer
          minimum: 1
        price:
          type: number
          minimum: 0
      required:
        - product_id
        - quantity
        - price

    Order:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        total:
          type: number
          minimum: 0
        status:
          type: string
          enum: [pending, processing, shipped, delivered, cancelled]
        created_at:
          type: string
          format: date-time
      required:
        - user_id
        - items
        - total
        - status

    Address:
      type: object
      properties:
        name:
          type: string
        street1:
          type: string
        street2:
          type: string
        city:
          type: string
        state:
          type: string
        zip:
          type: string
        country:
          type: string
      required:
        - name
        - street1
        - city
        - state
        - zip
        - country

    Parcel:
      type: object
      properties:
        length:
          type: number
          minimum: 0
        width:
          type: number
          minimum: 0
        height:
          type: number
          minimum: 0
        weight:
          type: number
          minimum: 0
      required:
        - length
        - width
        - height
        - weight

    ShippingRate:
      type: object
      properties:
        id:
          type: string
        service:
          type: string
        carrier:
          type: string
        rate:
          type: string
        currency:
          type: string
        shipment_id:
          type: string

    Category:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
      required:
        - name

    CartItem:
      type: object
      properties:
        product_id:
          type: string
        quantity:
          type: integer
          minimum: 1
      required:
        - product_id
        - quantity

    Error:
      type: object
      properties:
        detail:
          type: string
      required:
        - detail

paths:
  /:
    get:
      tags:
        - health
      summary: API Welcome Message
      description: Returns API welcome message
      responses:
        '200':
          description: Welcome message
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  version:
                    type: string

  /health:
    get:
      tags:
        - health
      summary: Health Check
      description: Health check endpoint to ensure the API is running
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string

  /test-db:
    get:
      tags:
        - health
      summary: Test Database Connectivity
      description: Test database connectivity
      responses:
        '200':
          description: Database connection status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  message:
                    type: string
                  collections_count:
                    type: integer

  /api/v1/auth/register:
    post:
      tags:
        - auth
      summary: Register New User
      description: Register a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/token:
    post:
      tags:
        - auth
      summary: Authenticate User
      description: Authenticate user and get access token
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
              required:
                - username
                - password
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Token'
        '401':
          description: Authentication failed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/auth/google:
    post:
      tags:
        - auth
      summary: Google OAuth Authentication
      description: Authenticate with Google OAuth2
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
                - token
      responses:
        '200':
          description: Authentication successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Token'

  /api/v1/users:
    get:
      tags:
        - users
      summary: List Users
      description: List all users or get single user by query param
      parameters:
        - name: id
          in: query
          description: User ID to get single user
          schema:
            type: string
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
      security:
        - BearerAuth: []

    post:
      tags:
        - users
      summary: Create User
      description: Create a new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User created successfully
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/users/{user_id}:
    get:
      tags:
        - users
      summary: Get User
      description: Get a single user by ID
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

    patch:
      tags:
        - users
      summary: Update User
      description: Update user information
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                first_name:
                  type: string
                last_name:
                  type: string
                email:
                  type: string
                  format: email
      responses:
        '200':
          description: User updated successfully
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

    delete:
      tags:
        - users
      summary: Delete User
      description: Delete a user
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: User deleted successfully
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/products:
    get:
      tags:
        - products
      summary: List Products
      description: List all products with pagination
      parameters:
        - name: id
          in: query
          description: Product ID to get single product
          schema:
            type: string
        - name: skip
          in: query
          description: Number of products to skip
          schema:
            type: integer
            minimum: 0
            default: 0
        - name: limit
          in: query
          description: Maximum number of products to return
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Product'

    post:
      tags:
        - products
      summary: Create Product
      description: Create a new product
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/products/{product_id}:
    get:
      tags:
        - products
      summary: Get Product
      description: Get a single product by ID
      parameters:
        - name: product_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - products
      summary: Update Product
      description: Update an existing product
      parameters:
        - name: product_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductCreate'
      responses:
        '200':
          description: Product updated successfully
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

    delete:
      tags:
        - products
      summary: Delete Product
      description: Delete a product
      parameters:
        - name: product_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Product deleted successfully
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/orders:
    get:
      tags:
        - orders
      summary: List Orders
      description: List all orders or get single order by query param
      parameters:
        - name: id
          in: query
          description: Order ID to get single order
          schema:
            type: string
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'
      security:
        - BearerAuth: []

    post:
      tags:
        - orders
      summary: Create Order
      description: Create a new order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: string
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/OrderItem'
                total:
                  type: number
                  minimum: 0
                status:
                  type: string
                  enum: [pending, processing, shipped, delivered, cancelled]
              required:
                - user_id
                - items
                - total
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
      security:
        - BearerAuth: []

  /api/v1/orders/{order_id}:
    get:
      tags:
        - orders
      summary: Get Order
      description: Get a single order by ID
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

    put:
      tags:
        - orders
      summary: Update Order
      description: Update an existing order
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [pending, processing, shipped, delivered, cancelled]
                total:
                  type: number
                  minimum: 0
      responses:
        '200':
          description: Order updated successfully
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

    delete:
      tags:
        - orders
      summary: Delete Order
      description: Delete an order
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Order deleted successfully
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/shipping/rates:
    post:
      tags:
        - shipping
      summary: Get Shipping Rates
      description: Get shipping rates for an address and parcel
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                to_address:
                  $ref: '#/components/schemas/Address'
                parcel:
                  $ref: '#/components/schemas/Parcel'
              required:
                - to_address
                - parcel
      responses:
        '200':
          description: Shipping rates
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ShippingRate'
      security:
        - BearerAuth: []

  /api/v1/shipping/purchase-label:
    post:
      tags:
        - shipping
      summary: Purchase Shipping Label
      description: Purchase a shipping label
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                shipment_id:
                  type: string
                rate_id:
                  type: string
              required:
                - shipment_id
                - rate_id
      responses:
        '200':
          description: Label purchased successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  label_url:
                    type: string
                    format: uri
                  tracking_code:
                    type: string
      security:
        - BearerAuth: []

  /api/v1/payments/create-payment-link:
    post:
      tags:
        - payments
      summary: Create Payment Link
      description: Create a Stripe Checkout Session (payment link)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                line_items:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      quantity:
                        type: string
                      base_price_money:
                        type: object
                        properties:
                          amount:
                            type: integer
                          currency:
                            type: string
                success_url:
                  type: string
                  format: uri
                cancel_url:
                  type: string
                  format: uri
                order_id:
                  type: string
              required:
                - line_items
                - success_url
                - cancel_url
      responses:
        '200':
          description: Payment link created
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    format: uri
      security:
        - BearerAuth: []

  /api/v1/categories:
    get:
      tags:
        - categories
      summary: List Categories
      description: List all categories or get single category by query param
      parameters:
        - name: id
          in: query
          description: Category ID
          schema:
            type: string
      responses:
        '200':
          description: List of categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

    post:
      tags:
        - categories
      summary: Create Category
      description: Create a new category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                is_active:
                  type: boolean
              required:
                - name
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
      security:
        - BearerAuth: []

  /api/v1/categories/{category_id}:
    get:
      tags:
        - categories
      summary: Get Category
      description: Get a single category by ID
      parameters:
        - name: category_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Category details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      tags:
        - categories
      summary: Update Category
      description: Update a category
      parameters:
        - name: category_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                is_active:
                  type: boolean
      responses:
        '200':
          description: Category updated successfully
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

    delete:
      tags:
        - categories
      summary: Delete Category
      description: Delete a category
      parameters:
        - name: category_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: Category deleted successfully
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/cart:
    get:
      tags:
        - cart
      summary: Get Cart
      description: Get cart contents
      responses:
        '200':
          description: Cart contents
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/CartItem'
                  total:
                    type: number
      security:
        - BearerAuth: []

    post:
      tags:
        - cart
      summary: Add to Cart
      description: Add item to cart
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartItem'
      responses:
        '200':
          description: Item added to cart
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  item:
                    $ref: '#/components/schemas/CartItem'
      security:
        - BearerAuth: []

    put:
      tags:
        - cart
      summary: Update Cart
      description: Update cart contents
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    $ref: '#/components/schemas/CartItem'
      responses:
        '200':
          description: Cart updated successfully
      security:
        - BearerAuth: []

    delete:
      tags:
        - cart
      summary: Clear Cart
      description: Clear cart
      responses:
        '200':
          description: Cart cleared
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
      security:
        - BearerAuth: []

  /api/v1/checkout:
    post:
      tags:
        - checkout
      summary: Create Checkout Session
      description: Create checkout session
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      product_id:
                        type: string
                      quantity:
                        type: integer
                        minimum: 1
              required:
                - items
      responses:
        '200':
          description: Checkout session created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  checkout_url:
                    type: string
                    format: uri
                  session_id:
                    type: string
      security:
        - BearerAuth: []

  /api/v1/upload:
    post:
      tags:
        - upload
      summary: Upload Image
      description: Upload an image file
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
              required:
                - image
      responses:
        '200':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    format: uri
        '400':
          description: Invalid file format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/profile:
    get:
      tags:
        - profile
      summary: Get User Profile
      description: Get user profile by query param
      parameters:
        - name: id
          in: query
          required: true
          description: User ID
          schema:
            type: string
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/profile/{user_id}:
    get:
      tags:
        - profile
      summary: Get User Profile by ID
      description: Get user profile by path parameter
      parameters:
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
      security:
        - BearerAuth: []

  /api/v1/send:
    post:
      tags:
        - email
      summary: Send Email
      description: Send an email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                to:
                  type: array
                  items:
                    type: string
                    format: email
                subject:
                  type: string
                body:
                  type: string
                html_body:
                  type: string
              required:
                - to
                - subject
                - body
      responses:
        '200':
          description: Email sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
      security:
        - BearerAuth: []

  /api/v1/register:
    post:
      tags:
        - email
      summary: Register Email
      description: Register an email for early access
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
              required:
                - email
      responses:
        '200':
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  email:
                    type: string
                    format: email

    get:
      tags:
        - email
      summary: Register Email (GET)
      description: Handle GET requests for email registration (Safari compatibility)
      parameters:
        - name: email
          in: query
          required: true
          description: Email address to register
          schema:
            type: string
            format: email
      responses:
        '200':
          description: Registration successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  email:
                    type: string
                    format: email